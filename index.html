<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NusaTask Admin Panel</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gray-950 text-gray-200 font-sans">

  <!-- Loading -->
  <div id="loading" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center hidden">
    <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-indigo-500"></div>
  </div>

  <!-- Login -->
  <div id="loginScreen" class="h-screen flex items-center justify-center">
    <div class="bg-gray-900 p-8 rounded-xl shadow-2xl w-96">
      <h1 class="text-3xl font-bold mb-6 text-center text-indigo-400">🔐 Admin Login</h1>
      <input id="email" type="email" placeholder="Email" class="w-full p-3 mb-4 rounded bg-gray-800 focus:outline-none">
      <input id="password" type="password" placeholder="Password" class="w-full p-3 mb-4 rounded bg-gray-800 focus:outline-none">
      <button onclick="login()" class="w-full bg-indigo-600 hover:bg-indigo-700 py-2 rounded-lg font-bold">Login</button>
    </div>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="hidden p-6">
    <h1 class="text-3xl font-bold mb-6 text-indigo-400">📊 NusaTask Admin Panel</h1>

    <!-- Navigation -->
    <div class="flex space-x-4 mb-6">
      <button onclick="showUsers()" class="tabBtn px-4 py-2 rounded bg-gray-800 hover:bg-indigo-700">👥 Users</button>
      <button onclick="showWithdrawals()" class="tabBtn px-4 py-2 rounded bg-gray-800 hover:bg-indigo-700">💸 Withdrawals</button>
      <button onclick="showBanned()" class="tabBtn px-4 py-2 rounded bg-gray-800 hover:bg-indigo-700">🚫 Banned</button>
    </div>

    <!-- Content -->
    <div id="content" class="bg-gray-900 p-4 rounded-xl shadow-lg"></div>
  </div>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCrFmaHbmL299cum51EtJIjt5NpukpTmho",
      authDomain: "penyimpanansaldo-280df.firebaseapp.com",
      databaseURL: "https://penyimpanansaldo-280df-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "penyimpanansaldo-280df",
      storageBucket: "penyimpanansaldo-280df.appspot.com",
      messagingSenderId: "659609775130",
      appId: "1:659609775130:web:bdd088ca5a877498c5b5a3",
      measurementId: "G-L4TW7E23H2"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    const loading = document.getElementById("loading");
    const loginScreen = document.getElementById("loginScreen");
    const dashboard = document.getElementById("dashboard");
    const content = document.getElementById("content");

    const ADMIN_UID = "MtTAFgAjMqVRDlEFdfsxT56m29i1";
    const ADMIN_EMAIL = "adminnusatask@gmail.com";

    function setLoading(state) {
      loading.classList.toggle("hidden", !state);
    }

    // Login
    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      setLoading(true);

      auth.signInWithEmailAndPassword(email, password)
        .then(userCred => {
          if (userCred.user.uid !== ADMIN_UID || email !== ADMIN_EMAIL) {
            setLoading(false);
            Swal.fire("❌ Akses Ditolak", "Bukan akun admin!", "error");
            auth.signOut();
            return;
          }
          setLoading(false);
          loginScreen.classList.add("hidden");
          dashboard.classList.remove("hidden");
          Swal.fire("✅ Login Berhasil", "", "success");
          localStorage.setItem("adminLoggedIn", "true");
        })
        .catch(err => {
          setLoading(false);
          Swal.fire("❌ Gagal Login", err.message, "error");
        });
    }

    // Auto login
    window.onload = () => {
      if (localStorage.getItem("adminLoggedIn") === "true") {
        loginScreen.classList.add("hidden");
        dashboard.classList.remove("hidden");
      }
    };

    // Show Users
    function showUsers() {
      setLoading(true);
      db.ref("users").once("value", snap => {
        setLoading(false);
        if (!snap.exists()) {
          content.innerHTML = "<p>No users found</p>";
          return;
        }
        let html = `<h2 class="text-xl mb-4">👥 Users</h2><table class="w-full text-left"><tr><th>Email</th><th>Saldo</th><th>Status</th></tr>`;
        snap.forEach(child => {
          const u = child.val();
          html += `<tr class="border-b border-gray-700"><td>${u.email || '-'}</td><td>Rp ${u.saldo || 0}</td><td>${u.status || 'active'}</td></tr>`;
        });
        html += "</table>";
        content.innerHTML = html;
      });
    }

    // Show Withdrawals
    function showWithdrawals() {
      setLoading(true);
      db.ref("withdrawals").once("value", snap => {
        setLoading(false);
        if (!snap.exists()) {
          content.innerHTML = "<p>No withdrawals yet</p>";
          return;
        }
        let html = `<h2 class="text-xl mb-4">💸 Withdrawals</h2><ul>`;
        snap.forEach(child => {
          const w = child.val();
          html += `<li class="border-b border-gray-700 py-2">User: ${w.userId} | Amount: Rp ${w.amount} | Status: ${w.status}</li>`;
        });
        html += "</ul>";
        content.innerHTML = html;
      });
    }

    // Show Banned
    function showBanned() {
      setLoading(true);
      db.ref("banned").once("value", snap => {
        setLoading(false);
        if (!snap.exists()) {
          content.innerHTML = "<p>No banned users</p>";
          return;
        }
        let html = `<h2 class="text-xl mb-4">🚫 Banned Users</h2><ul>`;
        snap.forEach(child => {
          html += `<li class="border-b border-gray-700 py-2">${child.key} <button onclick="unban('${child.key}')" class="bg-red-600 hover:bg-red-700 px-2 py-1 ml-2 rounded">Unban</button></li>`;
        });
        html += "</ul>";
        content.innerHTML = html;
      });
    }

    function unban(uid) {
      db.ref("banned/" + uid).remove()
        .then(() => Swal.fire("✅ User di-Unban", "", "success"))
        .catch(err => Swal.fire("❌ Error", err.message, "error"));
    }
  </script>
</body>
</html>
